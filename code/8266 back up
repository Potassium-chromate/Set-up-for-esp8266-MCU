#include <ESP8266WiFi.h>
#include <WiFiClient.h>
#include <ESP8266WebServer.h>
#include <ArduinoJson.h>
#include <SoftwareSerial.h>

const char *ssid = "your_password";
const char *password = "your_ssid";
const int serverPort = 80;




ESP8266WebServer server(serverPort);

void setup() {
  Serial.begin(9600);

  WiFi.mode(WIFI_AP);
  WiFi.softAP(ssid, password);

  IPAddress IP = WiFi.softAPIP();
  Serial.print("AP IP address: ");
  Serial.println(IP);

  server.on("/sendArray", HTTP_POST, handleArray);
  server.on("/test", HTTP_POST, testArray);
 
  server.begin();
  Serial.println("HTTP server started");
}

void loop() {
  server.handleClient();
}



void testArray() {
  if (server.hasArg("plain")) {
    String receivedArray = server.arg("plain");
    server.send(200, "text/plain", "Array received and processed: " + receivedArray);
  } else {
    server.send(400, "text/plain", "Missing array data");
  }
}

void handleArray() {
  if (server.hasArg("plain")) {
    String receivedArray = server.arg("plain");

    DynamicJsonDocument doc(1024);
    deserializeJson(doc, receivedArray);
    JsonArray array = doc.as<JsonArray>();

    for(JsonVariant v : array) {
      Serial.println(v.as<int>()); // Send each angle to the Arduino Mega.
    }

    server.send(200, "text/plain", "Received angles"); // Send response to client
  } else {
    server.send(400, "text/plain", "No angles provided");
  }
}
